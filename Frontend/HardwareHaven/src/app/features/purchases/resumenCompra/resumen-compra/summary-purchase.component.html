<div class="custom-container table-container">
  <ng-container *ngIf="loading">
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2 text-muted">Procesando compra...</p>
    </div>
  </ng-container>

  <ng-container *ngIf="purchaseFinished && purchaseMade && !loading">
    <div class="d-flex flex-column gap-4">
      <div
        class="text-center border-bottom border-light pb-3 mb-2"
        style="border-color: var(--glass-border) !important"
      >
        <h4 class="mb-1">Detalle de Compra</h4>
        <p class="text-muted mb-0">
          <i class="bi bi-calendar-event me-2"></i>
          {{ purchaseMade.fechaCompra | date : "dd/MM/yyyy" }}
        </p>
      </div>

      <table class="custom-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th class="text-center">Cant.</th>
            <th class="text-end">Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let purchaseLine of purchasesLine">
            <td>{{ purchaseLine.componente.name }}</td>
            <td class="text-center">x{{ purchaseLine.cantidad }}</td>
            <td class="text-end">
              ${{ purchaseLine.subTotal | number : "1.2-2" }}
            </td>
          </tr>
          <tr class="fw-bold fs-5">
            <td colspan="2" class="text-end pt-4">Total:</td>
            <td class="text-end pt-4 text-gradient">{{ total | currency }}</td>
          </tr>
        </tbody>
      </table>

      <div class="d-flex justify-content-center pt-3">
        <button class="btn btn-primary" (click)="invoiceButton()">
          <i class="bi bi-file-earmark-pdf me-2"></i> Descargar Factura
        </button>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="!loading && !purchaseFinished && !purchaseMade">
    <div class="no-compra">
      <div class="text-center">
        <i class="bi bi-x-circle text-danger fs-1"></i>
        <p class="highlight-message">No se pudo completar la compra</p>
        <button class="btn btn-outline-light mt-3" routerLink="/purchase">
          Intentar nuevamente
        </button>
      </div>
    </div>
  </ng-container>
</div>
